# Meal Planner Backend Importer

This project contains a Node.js script designed to import and synchronize recipe data from TheMealDB API into a Supabase database. It serves as the backend component for a meal planning application, ensuring quick and local access to recipe information.

---

## Features

* **Category Import:** Downloads a list of meal categories from TheMealDB.
* **Recipe Import:** Fetches comprehensive recipe details by the first letter of their name (from 'a' to 'z'), including instructions, ingredients, image, and video links.
* **Supabase Integration:** Seamlessly integrates with Supabase for data storage.

---

## Project Setup

### 1. Clone the Repository

git clone https://github.com/webAine/culinary_app_backend
cd culinary_app_backend

### 2. Install Dependencies

npm install

### 3. Configure Environment Variables (.env)

Create a .env file in the project's root directory (if it doesn't exist) and add the following variables:

    SUPABASE_URL: Your Supabase project URL, found in the Supabase dashboard (Project Settings -> API).

    SUPABASE_ANON_KEY: Your Supabase project's public key. This key is not used directly by this script but is crucial for your frontend application.

    SUPABASE_SERVICE_ROLE_KEY: Your Supabase project's service role key. This key is used by the script to grant full write access to your database. NEVER expose this key publicly (e.g., in client-side code or public repositories). It can be found in the Supabase dashboard (Project Settings -> API).

### 4. Database Setup in Supabase

Before running the script, ensure you have the following tables created in your Supabase database:

### categories

This table stores meal categories.
### SQL
```sql
CREATE TABLE public.categories (
    api_id TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()),
    PRIMARY KEY (api_id) -- Or id SERIAL PRIMARY KEY, if you added it
);
```
-- Ensure RLS is configured according to your needs (e.g., SELECT for 'anon').

### recipes

This table stores detailed recipe information.
### SQL

```sql
CREATE TABLE public.recipes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    api_id INT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    category TEXT,
    area TEXT,
    instructions TEXT,
    thumbnail_url TEXT,
    youtube_url TEXT,
    source_url TEXT,
    ingredients_json JSONB,
    tags TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now())
);
```
-- An index on api_id improves upsert performance
CREATE INDEX idx_recipes_api_id ON public.recipes (api_id);
-- For imports using SUPABASE_SERVICE_ROLE_KEY, RLS for this table can be temporarily disabled or configured for SELECT by 'anon'.

### Running the Import Script

The import script is located at scripts/importMeals.js.

### Bash

node scripts/importMeals.js

The script will display import progress in your console.


### Data Structure

categories

    api_id (TEXT, UNIQUE, NOT NULL): The category name from TheMealDB (used as an ID).

    name (TEXT, NOT NULL): The name of the category.

    created_at (TIMESTAMP WITH TIME ZONE): Timestamp of when the record was created.

recipes

    id (BIGINT, PRIMARY KEY): Internal auto-incrementing ID.

    api_id (INT, UNIQUE, NOT NULL): Unique recipe ID from TheMealDB.

    name (TEXT, NOT NULL): Name of the dish.

    category (TEXT): Category of the dish.

    area (TEXT): Cuisine/region.

    instructions (TEXT): Full cooking instructions.

    thumbnail_url (TEXT): URL to the recipe's thumbnail image.

    youtube_url (TEXT): URL to a YouTube video (if available).

    source_url (TEXT): URL to the original recipe source (if available).

    ingredients_json (JSONB): An array of JSON objects, where each object contains { "ingredient": "name", "measure": "quantity" }.

    tags (TEXT): Recipe tags (a comma-separated string).

    created_at (TIMESTAMP WITH TIME ZONE): Timestamp of when the record was created.
